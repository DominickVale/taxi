{"version":3,"file":"taxi.esm.js","sources":["../src/helpers.js","../src/Transition.js","../src/Renderer.js","../src/RouteStore.js","../src/Core.js"],"sourcesContent":["const parser = new DOMParser()\r\n\r\n/**\r\n * Parse a HTML string into a proper Document.\r\n * @param {string|Document} html\r\n * @return {Document|*}\r\n */\r\nexport function parseDom(html) {\r\n\treturn typeof html === 'string' ? parser.parseFromString(html, 'text/html') : html\r\n}\r\n\r\n/**\r\n * Extract details from a given URL string. Assumed to be on the current TLD.\r\n * @param {string} url\r\n * @return {{raw: string, href: string, host: string, hasHash: boolean, pathname: string}}\r\n */\r\nexport function processUrl(url) {\r\n\tconst details = new URL(url, window.location.origin)\r\n\tlet normalized = null\r\n\r\n\tif (details.hash.length) {\r\n\t\tnormalized = url.replace(details.hash, '')\r\n\t}\r\n\r\n\treturn {\r\n\t\thasHash: details.hash.length > 0,\r\n\t\tpathname: details.pathname,\r\n\t\thost: details.host,\r\n\t\traw: url,\r\n\t\thref: normalized || details.href\r\n\t}\r\n}\r\n\r\n/**\r\n * Reloads a provided script/stylesheet by replacing with itself.\r\n * @param {HTMLElement} node\r\n */\r\nexport function reloadScript(node) {\r\n\tnode.parentNode.replaceChild(duplicateScript(node), node)\r\n}\r\n\r\n/**\r\n * Loads a provided script/stylesheet by appending a clone to the current document.\r\n * @param {HTMLElement} node\r\n */\r\nexport function appendScript(node) {\r\n\tif (node.parentNode.tagName === 'HEAD') {\r\n\t\tdocument.head.appendChild(duplicateScript(node))\r\n\t} else {\r\n\t\tdocument.body.appendChild(duplicateScript(node))\r\n\t}\r\n}\r\n\r\n/**\r\n * Creates a clone of a given HTMLElement\r\n * @param {HTMLElement} node\r\n * @return {HTMLElement}\r\n */\r\nexport function duplicateScript(node) {\r\n\tconst replacement = document.createElement('SCRIPT')\r\n\r\n\t// Loop Over Attributes\r\n\tfor (let k = 0; k < node.attributes.length; k++) {\r\n\t\t// Get Attribute\r\n\t\tconst attr = node.attributes[k]\r\n\r\n\t\t// Set Attribute\r\n\t\treplacement.setAttribute(attr.nodeName, attr.nodeValue)\r\n\t}\r\n\r\n\t// Inline Script\r\n\tif (node.innerHTML) {\r\n\t\treplacement.innerHTML = node.innerHTML\r\n\t}\r\n\r\n\treturn replacement\r\n}\r\n","export default class Transition {\r\n\t/**\r\n\t * @param {{wrapper: HTMLElement}} props\r\n\t */\r\n\tconstructor({ wrapper }) {\r\n\t\tthis.wrapper = wrapper\r\n\t}\r\n\r\n\t/**\r\n\t * @param {{ from: HTMLElement|Element, trigger: string|HTMLElement|false }} props\r\n\t * @return {Promise<void>}\r\n\t */\r\n\tleave(props) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.onLeave({ ...props, done: resolve })\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * @param {{ to: HTMLElement|Element, trigger: string|HTMLElement|false }} props\r\n\t * @return {Promise<void>}\r\n\t */\r\n\tenter(props) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.onEnter({ ...props, done: resolve })\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Handle the transition leaving the previous page.\r\n\t * @param {{from: HTMLElement|Element, trigger: string|HTMLElement|false, done: function}} props\r\n\t */\r\n\tonLeave({ from, trigger, done }) {\r\n\t\tdone()\r\n\t}\r\n\r\n\t/**\r\n\t * Handle the transition entering the next page.\r\n\t * @param {{to: HTMLElement|Element, trigger: string|HTMLElement|false, done: function}} props\r\n\t */\r\n\tonEnter({ to, trigger, done }) {\r\n\t\tdone()\r\n\t}\r\n}\r\n","import Transition from \"./Transition\"\r\n\r\nexport default class Renderer {\r\n\t/**\r\n\t * @param {{content: HTMLElement|Element, page: Document|Node, title: string, wrapper: Element}} props\r\n\t */\r\n\tconstructor({ content, page, title, wrapper }) {\r\n\t\tthis._contentString = content.outerHTML\r\n\t\tthis._DOM = null\r\n\t\tthis.page = page\r\n\t\tthis.title = title\r\n\t\tthis.wrapper = wrapper\r\n\t\tthis.content = this.wrapper.lastElementChild\r\n\t}\r\n\r\n\tonEnter() {\r\n\r\n\t}\r\n\r\n\tonEnterCompleted() {\r\n\r\n\t}\r\n\r\n\tonLeave() {\r\n\r\n\t}\r\n\r\n\tonLeaveCompleted() {\r\n\r\n\t}\r\n\r\n\tinitialLoad() {\r\n\t\tthis.onEnter()\r\n\t\tthis.onEnterCompleted()\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tdocument.title = this.title\r\n\t\tthis.wrapper.appendChild(this._DOM.firstElementChild)\r\n\t\tthis.content = this.wrapper.lastElementChild\r\n\t\tthis._DOM = null\r\n\t}\r\n\r\n\tcreateDom() {\r\n\t\tif (!this._DOM) {\r\n\t\t\tthis._DOM = document.createElement('div')\r\n\t\t\tthis._DOM.innerHTML = this._contentString\r\n\t\t}\r\n\t}\r\n\r\n\tremove() {\r\n\t\tthis.wrapper.firstElementChild.remove()\r\n\t}\r\n\r\n\t/**\r\n\t * Called when transitioning into the current page.\r\n\t * @param {Transition} transition\r\n\t * @param {string|HTMLElement|false} trigger\r\n\t * @return {Promise<null>}\r\n\t */\r\n\tenter(transition, trigger) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.onEnter()\r\n\r\n\t\t\ttransition.enter({ trigger, to: this.content })\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis.onEnterCompleted()\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Called when transitioning away from the current page.\r\n\t * @param {Transition} transition\r\n\t * @param {string|HTMLElement|false} trigger\r\n\t * @param {boolean} removeOldContent\r\n\t * @return {Promise<null>}\r\n\t */\r\n\tleave(transition, trigger, removeOldContent) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.onLeave()\r\n\r\n\t\t\ttransition.leave({ trigger, from: this.content })\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tif (removeOldContent) {\r\n\t\t\t\t\t\tthis.remove()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.onLeaveCompleted()\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n","export default class RouteStore {\r\n\t/**\r\n\t * @type {Map<string, Map<string, string>>}\r\n\t */\r\n\tdata = new Map()\r\n\r\n\t/**\r\n\t * @type {Map<string, RegExp>}\r\n\t */\r\n\tregexCache = new Map()\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} fromPattern\r\n\t * @param {string} toPattern\r\n\t * @param {string} transition\r\n\t */\r\n\tadd(fromPattern, toPattern, transition) {\r\n\t\tif (!this.data.has(fromPattern)) {\r\n\t\t\tthis.data.set(fromPattern, new Map())\r\n\t\t\tthis.regexCache.set(fromPattern, new RegExp(`^${fromPattern}$`))\r\n\t\t}\r\n\r\n\t\tthis.data.get(fromPattern).set(toPattern, transition)\r\n\t\tthis.regexCache.set(toPattern, new RegExp(`^${toPattern}$`))\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} currentUrl\r\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} nextUrl\r\n\t * @return {string|null}\r\n\t */\r\n\tfindMatch(currentUrl, nextUrl) {\r\n\t\t// Loop through all from patterns\r\n\t\tfor (const [fromPattern, potentialMatches] of this.data) {\r\n\t\t\t// If we have a match\r\n\t\t\tif (currentUrl.pathname.match(this.regexCache.get(fromPattern))) {\r\n\t\t\t\t// loop through all associated to patterns\r\n\t\t\t\tfor (const [toPattern, transition] of potentialMatches) {\r\n\t\t\t\t\t// If we find a match, return it\r\n\t\t\t\t\tif (nextUrl.pathname.match(this.regexCache.get(toPattern))) {\r\n\t\t\t\t\t\treturn transition\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null\r\n\t}\r\n}\r\n","import E from '@unseenco/e'\r\nimport { appendScript, parseDom, processUrl, reloadScript } from './helpers'\r\nimport Transition from './Transition'\r\nimport Renderer from './Renderer'\r\nimport RouteStore from './RouteStore'\r\n\r\nconst IN_PROGRESS = 'A transition is currently in progress'\r\n\r\n/**\r\n * @typedef CacheEntry\r\n * @type {object}\r\n * @property {Renderer} renderer\r\n * @property {Document|Node} page\r\n * @property {array} scripts\r\n * @property {string} title\r\n * @property {HTMLElement|Element} content\r\n */\r\n\r\nexport default class Core {\r\n\tisTransitioning = false\r\n\r\n\t/**\r\n\t * @type {CacheEntry|null}\r\n\t */\r\n\tcurrentCacheEntry = null\r\n\r\n\t/**\r\n\t * @type {Map<string, CacheEntry>}\r\n\t */\r\n\tcache = new Map()\r\n\r\n\t/**\r\n\t * @param {{\r\n\t * \t\tlinks?: string,\r\n\t * \t\tremoveOldContent?: boolean,\r\n\t * \t\tallowInterruption?: boolean,\r\n\t * \t\trenderers?: Object.<string, Renderer>,\r\n\t * \t\ttransitions?: Object.<string, Transition>,\r\n\t * \t\treloadJsFilter?: boolean|function(HTMLElement): boolean\r\n\t * }} parameters\r\n\t */\r\n\tconstructor(parameters = {}) {\r\n\t\tconst {\r\n\t\t\tlinks = 'a:not([target]):not([href^=\\\\#]):not([data-taxi-ignore])',\r\n\t\t\tremoveOldContent = true,\r\n\t\t\tallowInterruption = false,\r\n\t\t\trenderers = {\r\n\t\t\t\tdefault: Renderer\r\n\t\t\t},\r\n\t\t\ttransitions = {\r\n\t\t\t\tdefault: Transition\r\n\t\t\t},\r\n\t\t\treloadJsFilter = (element) => element.dataset.taxiReload !== undefined\r\n\t\t} = parameters\r\n\r\n\t\tthis.renderers = renderers\r\n\t\tthis.transitions = transitions\r\n\t\tthis.defaultRenderer = this.renderers.default || Renderer\r\n\t\tthis.defaultTransition = this.transitions.default || Transition\r\n\t\tthis.wrapper = document.querySelector('[data-taxi]')\r\n\t\tthis.reloadJsFilter = reloadJsFilter\r\n\t\tthis.removeOldContent = removeOldContent\r\n\t\tthis.allowInterruption = allowInterruption\r\n\t\tthis.cache = new Map()\r\n\t\tthis.isPopping = false\r\n\r\n\t\t// Add delegated link events\r\n\t\tthis.attachEvents(links)\r\n\r\n\t\tthis.currentLocation = processUrl(window.location.href)\r\n\r\n\t\t// as this is the initial page load, prime this page into the cache\r\n\t\tthis.cache.set(this.currentLocation.href, this.createCacheEntry(document.cloneNode(true)))\r\n\r\n\t\t// fire the current Renderer enter methods\r\n\t\tthis.currentCacheEntry = this.cache.get(this.currentLocation.href)\r\n\t\tthis.currentCacheEntry.renderer.initialLoad()\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} renderer\r\n\t */\r\n\tsetDefaultRenderer(renderer) {\r\n\t\tthis.defaultRenderer = this.renderers[renderer]\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} transition\r\n\t */\r\n\tsetDefaultTransition(transition) {\r\n\t\tthis.defaultTransition = this.transitions[transition]\r\n\t}\r\n\r\n\t/**\r\n\t * Registers a route into the RouteStore\r\n\t *\r\n\t * @param {string} fromPattern\r\n\t * @param {string} toPattern\r\n\t * @param {string} transition\r\n\t */\r\n\taddRoute(fromPattern, toPattern, transition) {\r\n\t\tif (!this.router) {\r\n\t\t\tthis.router = new RouteStore()\r\n\t\t}\r\n\r\n\t\tthis.router.add(fromPattern, toPattern, transition)\r\n\t}\r\n\r\n\t/**\r\n\t * Prime the cache for a given URL\r\n\t *\r\n\t * @param {string} url\r\n\t * @param {boolean} [preloadAssets]\r\n\t * @return {Promise}\r\n\t */\r\n\tpreload(url, preloadAssets = false) {\r\n\t\t// convert relative URLs to absolute\r\n\t\turl = processUrl(url).href\r\n\r\n\t\tif (!this.cache.has(url)) {\r\n\t\t\treturn this.fetch(url, false)\r\n\t\t\t\t.then(async (newPage) => {\r\n\t\t\t\t\tthis.cache.set(url, this.createCacheEntry(newPage))\r\n\r\n\t\t\t\t\tif (preloadAssets) {\r\n\t\t\t\t\t\tthis.cache.get(url).renderer.createDom()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve()\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the HTML cache for the current URL\r\n\t * Useful when adding/removing content via AJAX such as a search page or infinite loader\r\n\t */\r\n\tupdateCache() {\r\n\t\tconst key = processUrl(window.location.href).href\r\n\r\n\t\tif (this.cache.has(key)) {\r\n\t\t\tthis.cache.delete(key)\r\n\t\t\tthis.cache.set(key, this.createCacheEntry(document.cloneNode(true)))\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the cache for a given URL.\r\n\t * If no URL is passed, then cache for the current page is cleared.\r\n\t *\r\n\t * @param {string} [url]\r\n\t */\r\n\tclearCache(url) {\r\n\t\tconst key = processUrl(url || window.location.href).href\r\n\r\n\t\tif (this.cache.has(key)) {\r\n\t\t\tthis.cache.delete(key)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string|false} [transition]\r\n\t * @param {string|false|HTMLElement} [trigger]\r\n\t * @return {Promise<void|Error>}\r\n\t */\r\n\tnavigateTo(url, transition = false, trigger = false) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t// Don't allow multiple navigations to occur at once\r\n\t\t\tif (!this.allowInterruption && this.isTransitioning) {\r\n\t\t\t\treject(new Error(IN_PROGRESS))\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tthis.isTransitioning = true\r\n\t\t\tthis.isPopping = true\r\n\t\t\tthis.targetLocation = processUrl(url)\r\n\t\t\tthis.popTarget = window.location.href\r\n\r\n\t\t\tconst TransitionClass = new (this.chooseTransition(transition))({ wrapper: this.wrapper })\r\n\r\n\t\t\tlet navigationPromise\r\n\r\n\t\t\tif (!this.cache.has(this.targetLocation.href)) {\r\n\t\t\t\tconst fetched = this.fetch(this.targetLocation.raw)\r\n\t\t\t\t\t.then((newPage) => {\r\n\t\t\t\t\t\tthis.cache.set(this.targetLocation.href, this.createCacheEntry(newPage))\r\n\t\t\t\t\t\tthis.cache.get(this.targetLocation.href).renderer.createDom()\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\tnavigationPromise = this.beforeFetch(this.targetLocation, TransitionClass, trigger)\r\n\t\t\t\t\t.then(async () => {\r\n\t\t\t\t\t\treturn fetched.then(async (newPage) => {\r\n\t\t\t\t\t\t\treturn await this.afterFetch(this.targetLocation, TransitionClass, this.cache.get(this.targetLocation.href), trigger)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tthis.cache.get(this.targetLocation.href).renderer.createDom()\r\n\r\n\t\t\t\tnavigationPromise = this.beforeFetch(this.targetLocation, TransitionClass, trigger)\r\n\t\t\t\t\t.then(async () => {\r\n\t\t\t\t\t\treturn await this.afterFetch(this.targetLocation, TransitionClass, this.cache.get(this.targetLocation.href), trigger)\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tnavigationPromise.then(() => {\r\n\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Add an event listener.\r\n\t * @param {string} event\r\n\t * @param {any} callback\r\n\t */\r\n\ton(event, callback) {\r\n\t\tE.on(event, callback)\r\n\t}\r\n\r\n\t/**\r\n\t * Remove an event listener.\r\n\t * @param {string} event\r\n\t * @param {any} [callback]\r\n\t */\r\n\toff(event, callback) {\r\n\t\tE.off(event, callback)\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {{ raw: string, href: string, hasHash: boolean, pathname: string }} url\r\n\t * @param {Transition} TransitionClass\r\n\t * @param {string|HTMLElement|false} trigger\r\n\t * @return {Promise<void>}\r\n\t */\r\n\tbeforeFetch(url, TransitionClass, trigger) {\r\n\t\tE.emit('NAVIGATE_OUT', {\r\n\t\t\tfrom: this.currentCacheEntry,\r\n\t\t\ttrigger\r\n\t\t})\r\n\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.currentCacheEntry.renderer.leave(TransitionClass, trigger, this.removeOldContent)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tif (trigger !== 'popstate') {\r\n\t\t\t\t\t\twindow.history.pushState({}, '', url.raw)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {{ raw: string, href: string, host: string, hasHash: boolean, pathname: string }} url\r\n\t * @param {Transition} TransitionClass\r\n\t * @param {CacheEntry} entry\r\n\t * @param {string|HTMLElement|false} trigger\r\n\t * @return {Promise<void>}\r\n\t */\r\n\tafterFetch(url, TransitionClass, entry, trigger) {\r\n\t\t// add this page to cache\r\n\t\tif (!this.cache.has(url.href)) {\r\n\t\t\tthis.cache.set(url.href, entry)\r\n\t\t}\r\n\r\n\t\tthis.currentLocation = url\r\n\t\tthis.popTarget = this.currentLocation.href\r\n\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tentry.renderer.update()\r\n\r\n\t\t\tE.emit('NAVIGATE_IN', {\r\n\t\t\t\tfrom: this.currentCacheEntry,\r\n\t\t\t\tto: entry,\r\n\t\t\t\ttrigger\r\n\t\t\t})\r\n\r\n\t\t\tif (this.reloadJsFilter) {\r\n\t\t\t\tthis.loadScripts(entry.scripts)\r\n\t\t\t}\r\n\r\n\t\t\tentry.renderer.enter(TransitionClass, trigger)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tE.emit('NAVIGATE_END', {\r\n\t\t\t\t\t\tfrom: this.currentCacheEntry,\r\n\t\t\t\t\t\tto: entry,\r\n\t\t\t\t\t\ttrigger\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tthis.currentCacheEntry = entry\r\n\t\t\t\t\tthis.isTransitioning = false\r\n\t\t\t\t\tthis.isPopping = false\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Load up scripts from the target page if needed\r\n\t *\r\n\t * @param {HTMLElement[]} cachedScripts\r\n\t */\r\n\tloadScripts(cachedScripts) {\r\n\t\tconst newScripts = [...cachedScripts]\r\n\t\tconst currentScripts = Array.from(document.querySelectorAll('script')).filter(this.reloadJsFilter)\r\n\r\n\t\t// loop through all new scripts\r\n\t\tfor (let i = 0; i < currentScripts.length; i++) {\r\n\t\t\tfor (let n = 0; n < newScripts.length; n++) {\r\n\t\t\t\tif (currentScripts[i].outerHTML === newScripts[n].outerHTML) {\r\n\t\t\t\t\treloadScript(currentScripts[i])\r\n\t\t\t\t\tnewScripts.splice(n, 1)\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const script of newScripts) {\r\n\t\t\tappendScript(script)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {string} links\r\n\t */\r\n\tattachEvents(links) {\r\n\t\tE.delegate('click', links, this.onClick)\r\n\t\tE.delegate('mouseenter focus', links, this.onPreload)\r\n\t\tE.on('popstate', window, this.onPopstate)\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {MouseEvent} e\r\n\t */\r\n\tonClick = (e) => {\r\n\t\tif (!(e.metaKey || e.ctrlKey)) {\r\n\t\t\tconst target = processUrl(e.currentTarget.href)\r\n\t\t\tthis.currentLocation = processUrl(window.location.href)\r\n\r\n\t\t\tif (this.currentLocation.host !== target.host) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t// the target is a new URL, or is removing the hash from the current URL\r\n\t\t\tif (this.currentLocation.href !== target.href || (this.currentLocation.hasHash && !target.hasHash)) {\r\n\t\t\t\te.preventDefault()\r\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\t\t\tthis.navigateTo(target.raw, e.currentTarget.dataset.transition || false, e.currentTarget).catch(err => console.warn(err))\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t// a click to the current URL was detected\r\n\t\t\tif (!this.currentLocation.hasHash && !target.hasHash) {\r\n\t\t\t\te.preventDefault()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonPreload = (e) => {\r\n\t\tconst target = processUrl(e.currentTarget.href)\r\n\r\n\t\tif (this.currentLocation.host !== target.host) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tthis.preload(e.currentTarget.href)\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @return {void|boolean}\r\n\t */\r\n\tonPopstate = () => {\r\n\t\t// don't trigger for on-page anchors\r\n\t\tif (window.location.pathname === this.currentLocation.pathname && !this.isPopping) {\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tif (!this.allowInterruption && (this.isTransitioning || this.isPopping)) {\r\n\t\t\t// overwrite history state with current page if currently navigating\r\n\t\t\twindow.history.pushState({}, '', this.popTarget)\r\n\t\t\tconsole.warn(IN_PROGRESS)\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tif (!this.isPopping) {\r\n\t\t\tthis.popTarget = window.location.href\r\n\t\t}\r\n\r\n\t\tthis.isPopping = true\r\n\r\n\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\tthis.navigateTo(window.location.href, false, 'popstate')\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {string} url\r\n\t * @param {boolean} [runFallback]\r\n\t * @return {Promise<Document>}\r\n\t */\r\n\tfetch(url, runFallback = true) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tfetch(url, {\r\n\t\t\t\tmode: 'same-origin',\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\theaders: { 'X-Requested-With': 'Taxi' },\r\n\t\t\t\tcredentials: 'same-origin'\r\n\t\t\t})\r\n\t\t\t\t.then((response) => {\r\n\t\t\t\t\tif (!response.ok) {\r\n\t\t\t\t\t\treject('Taxi encountered a non 2xx HTTP status code')\r\n\r\n\t\t\t\t\t\tif (runFallback) {\r\n\t\t\t\t\t\t\twindow.location.href = url\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn response.text()\r\n\t\t\t\t})\r\n\t\t\t\t.then((htmlString) => {\r\n\t\t\t\t\tresolve(parseDom(htmlString))\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err) => {\r\n\t\t\t\t\treject(err)\r\n\r\n\t\t\t\t\tif (runFallback) {\r\n\t\t\t\t\t\twindow.location.href = url\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {string|false} transition\r\n\t * @return {Transition|function}\r\n\t */\r\n\tchooseTransition(transition) {\r\n\t\tif (transition) {\r\n\t\t\treturn this.transitions[transition]\r\n\t\t}\r\n\r\n\t\tconst routeTransition = this.router?.findMatch(this.currentLocation, this.targetLocation)\r\n\r\n\t\tif (routeTransition) {\r\n\t\t\treturn this.transitions[routeTransition]\r\n\t\t}\r\n\r\n\t\treturn this.defaultTransition\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {Document|Node} page\r\n\t * @return {CacheEntry}\r\n\t */\r\n\tcreateCacheEntry(page) {\r\n\t\tconst content = page.querySelector('[data-taxi-view]')\r\n\t\tconst Renderer = content.dataset.taxiView.length ? this.renderers[content.dataset.taxiView] : this.defaultRenderer\r\n\r\n\t\treturn {\r\n\t\t\tpage,\r\n\t\t\tcontent,\r\n\t\t\tscripts: this.reloadJsFilter ? Array.from(page.querySelectorAll('script')).filter(this.reloadJsFilter) : [],\r\n\t\t\ttitle: page.title,\r\n\t\t\trenderer: new Renderer({\r\n\t\t\t\twrapper: this.wrapper,\r\n\t\t\t\ttitle: page.title,\r\n\t\t\t\tcontent,\r\n\t\t\t\tpage\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["parser","DOMParser","processUrl","url","details","URL","window","location","origin","normalized","hash","length","replace","hasHash","pathname","host","raw","href","appendScript","node","parentNode","tagName","document","head","appendChild","duplicateScript","body","replacement","createElement","k","attributes","attr","setAttribute","nodeName","nodeValue","innerHTML","Transition","this","wrapper","leave","props","Promise","resolve","_this","onLeave","done","enter","_this2","onEnter","Renderer","page","title","_contentString","content","outerHTML","_DOM","lastElementChild","onEnterCompleted","onLeaveCompleted","initialLoad","update","firstElementChild","createDom","remove","transition","trigger","to","then","removeOldContent","from","RouteStore","data","Map","regexCache","add","fromPattern","toPattern","has","set","RegExp","get","findMatch","currentUrl","nextUrl","potentialMatches","match","IN_PROGRESS","Core","parameters","isTransitioning","currentCacheEntry","cache","onClick","e","metaKey","ctrlKey","target","currentTarget","currentLocation","preventDefault","navigateTo","dataset","err","console","warn","onPreload","preload","onPopstate","isPopping","allowInterruption","popTarget","history","pushState","links","renderers","transitions","default","reloadJsFilter","element","undefined","taxiReload","defaultRenderer","defaultTransition","querySelector","attachEvents","createCacheEntry","cloneNode","renderer","setDefaultRenderer","setDefaultTransition","addRoute","router","preloadAssets","fetch","newPage","updateCache","key","clearCache","reject","_this3","targetLocation","navigationPromise","TransitionClass","chooseTransition","beforeFetch","afterFetch","fetched","Error","on","event","callback","E","off","emit","_this4","entry","_this5","loadScripts","scripts","cachedScripts","newScripts","currentScripts","Array","querySelectorAll","filter","i","n","replaceChild","splice","delegate","runFallback","mode","method","headers","credentials","response","ok","text","htmlString","html","parseFromString","routeTransition","_this$router","taxiView"],"mappings":"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"}